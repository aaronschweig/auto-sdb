<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- include favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
      integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'media',
      };
    </script>
    <script src="https://unpkg.com/@alenaksu/json-viewer@0.3.4"></script>
    <title>SDB-Extractor</title>
    <style>
      @media (prefers-color-scheme: light) {
        json-viewer {
          --background-color: white;
          --string-color: #000;
        }
      }
      @media (prefers-color-scheme: dark) {
        json-viewer {
          --background-color: rgb(107 114 128);
          --string-color: rgb(249 250 251);
        }
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-gray-100 py-6 flex flex-col justify-center mx-8 dark:bg-gray-800 dark:text-gray-50"
  >
    <h1 class="text-4xl py-4">SDB-Extractor</h1>
    <div class="grid grid-cols-2 gap-4">
      <div
        class="flex flex-col justify-around items-center px-4 bg-white dark:bg-gray-500 shadow-lg rounded-3xl"
      >
        <label for="file">
          Datei hochladen
          <input type="file" name="file" id="file" />
        </label>
        <button
          class="px-3 py-2 bg-blue-600 rounded shadow text-white text-lg w-72"
          id="upload"
        >
          Extract
        </button>
      </div>
      <div
        class="bg-white dark:bg-gray-500 flex justify-center px-4 py-10 rounded-3xl shadow-lg"
      >
        <svg
          id="loading-spinner"
          class="animate-spin h-16 text-green-700 dark:text-teal-200 hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <json-viewer id="result" ></json-viewer>
      </div>
    </div>
    <script>
      const fileInput = document.getElementById('file');
      const uploadBtn = document.getElementById('upload');
      const resultArea = document.getElementById('result');
      const loadingSpinner = document.getElementById('loading-spinner');

      resultArea.data = {
        bezeichnung: 'bezeichnung des stoffs',
        lagerklasse: '3',
        signalwort: 'Gefahr',
        hSaezte: ['H225', 'H315', 'H361f', 'H336', 'H373', 'H304', 'H411'],
        pSaezte: [
          'P210',
          'P243',
          'P273',
          'P301+P330+P331',
          'P370+P378',
          'P403',
        ],
        ghs: ['GHS01'],
        wgk: '1',
      };

      uploadBtn.addEventListener('click', async () => {
        const form = new FormData();
        form.set('file', fileInput.files[0]);

        loadingSpinner.classList.remove('hidden');
        resultArea.data = {};

        const result = await fetch('/extract', {
          method: 'POST',
          body: form,
        }).then((res) => res.json());
        loadingSpinner.classList.add('hidden');
        resultArea.data = result;
      });
    </script>
  </body>
</html>
